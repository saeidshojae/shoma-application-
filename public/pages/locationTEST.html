<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فرم ثبت لوکیشن</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font@v3.0.1/dist/font-face.css">
    <style>
        body {
            font-family: 'Shabnam', sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh; /* برای اطمینان از نمایش کامل فرم */
            margin: 0;
            overflow-y: auto; /* اضافه کردن اسکرول عمودی */
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
            box-sizing: border-box;
            text-align: right;
            direction: rtl;
        }
        .container h2 {
            margin-bottom: 20px;
            text-align: center;
            color: #4CAF50;
        }
        .form-group {
            margin-bottom: 15px;
            position: relative;
        }
        .form-group select, .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: 'Shabnam', sans-serif;
        }
        .form-group input[type="submit"], .form-group button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.3s ease; /* اضافه کردن انیمیشن تغییر رنگ پس زمینه */
            font-family: 'Shabnam', sans-serif; /* تغییر فونت نوشته‌های روی دکمه‌ها */
        }
        .form-group input[type="submit"]:hover, .form-group button:hover {
            background-color: #45a049;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            max-height: 150px;
            overflow-y: auto;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        #map {
            height: 300px;
            width: 100%;
            margin-top: 20px;
            display: block;
        }
        @media (min-width: 600px) {
            .container {
                width: 400px;
            }
        }
    </style>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_VALID_API_KEY&callback=initMap"></script>
</head>
<body>
    <div class="container">
        <h2>فرم ثبت لوکیشن</h2>
        <form id="locationForm" action="php/location.php" method="POST">
            <div class="form-group">
                <label for="locationDisplay">مکان انتخاب شده:</label>
                <input type="text" id="locationDisplay" name="locationDisplay" readonly>
            </div>
            <div class="form-group">
                <label for="country">از کشور تا کوچه خود را انتخاب کنید:</label>
                <select id="country" name="country">
                    <option value="" disabled selected>انتخاب کنید</option>
                    <option value="ایران">ایران</option>
                    <option value="آلمان">آلمان</option>
                    <option value="ایتالیا">ایتالیا</option>
                    <option value="هند">هند</option>
                </select>
                <div class="dropdown-content" id="iranProvinces">
                    <a href="#" data-province="تهران">تهران</a>
                    <a href="#" data-province="مازندران">مازندران</a>
                </div>
                <div class="dropdown-content" id="tehranCounties">
                    <a href="#" data-county="تهران بزرگ">تهران بزرگ</a>
                    <a href="#" data-county="ری">ری</a>
                    <a href="#" data-county="شمیرانات">شمیرانات</a>
                    <a href="#" data-county="اسلامشهر">اسلامشهر</a>
                    <a href="#" data-county="شهریار">شهریار</a>
                </div>
                <div class="dropdown-content" id="countySections">
                    <a href="#" data-section="بخش مرکزی">بخش مرکزی</a>
                    <a href="#" data-section="بخش آفتاب">بخش آفتاب</a>
                    <a href="#" data-section="بخش کن">بخش کن</a>
                </div>
                <div class="dropdown-content" id="districts">
                    <a href="#" data-district="تهران بزرگ">تهران بزرگ</a>
                    <a href="#" data-district="دهستان سیاهرود">دهستان سیاهرود</a>
                    <a href="#" data-district="شهر/دهستان 3">شهر/دهستان 3</a>
                </div>
                <div class="dropdown-content" id="villages">
                    <a href="#" data-village="منطقه/روستا 1">منطقه/روستا 1</a>
                    <a href="#" data-village="منطقه/روستا 2">منطقه/روستا 2</a>
                    <a href="#" data-village="منطقه/روستا 3">منطقه/روستا 3</a>
                </div>
                <div class="dropdown-content" id="areas">
                    <a href="#" data-area="محله 1">محله 1</a>
                    <a href="#" data-area="محله 2">محله 2</a>
                    <a href="#" data-area="محله 3">محله 3</a>
                </div>
                <div class="dropdown-content" id="streets">
                    <a href="#" data-street="خیابان 1">خیابان 1</a>
                    <a href="#" data-street="خیابان 2">خیابان 2</a>
                    <a href="#" data-street="خیابان 3">خیابان 3</a>
                </div>
                <div class="dropdown-content" id="alleys">
                    <a href="#" data-alley="کوچه 1">کوچه 1</a>
                    <a href="#" data-alley="کوچه 2">کوچه 2</a>
                    <a href="#" data-alley="کوچه 3">کوچه 3</a>
                </div>
            </div>
            <div class="form-group">
                <button type="button" id="detectLocation">تشخیص موقعیت من</button>
            </div>
            <div class="form-group">
                <input type="submit" value="ثبت">
            </div>
            <div id="map"></div>
        </form>
    </div>
    <script>
        function initMap() {
            let map, marker;

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 35.6892, lng: 51.3890 }, // Default to Tehran
                zoom: 8,
            });

            marker = new google.maps.Marker({
                position: { lat: 35.6892, lng: 51.3890 },
                map: map,
            });

            map.addListener('click', function(event) {
                placeMarker(event.latLng);
            });
        }

        function placeMarker(location) {
            marker.setPosition(location);
            updateLocationDisplay(location);
        }

        function updateLocationDisplay(location) {
            const locationDisplay = `مکان انتخاب شده: ${location.lat()}, ${location.lng()}`;
        document.getElementById('locationDisplay').value = locationDisplay;
    }

    document.getElementById('detectLocation').addEventListener('click', function() {
        const loadingMessage = document.createElement('div');
        loadingMessage.id = 'loadingMessage';
        loadingMessage.textContent = 'در حال تشخیص موقعیت...';
        document.body.appendChild(loadingMessage);
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                };

                marker.setPosition(pos);
                map.setCenter(pos);
                updateLocationDisplay(pos);
                document.body.removeChild(loadingMessage);
            }, function(error) {
                handleLocationError(true, error);
                document.body.removeChild(loadingMessage);
            });
        } else {
            handleLocationError(false, null);
            document.body.removeChild(loadingMessage);
        }
    });

    function handleLocationError(browserHasGeolocation, error) {
        let errorMessage = 'خطا در دسترسی به موقعیت مکانی شما.';
        if (error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'دسترسی به موقعیت مکانی شما رد شد. لطفاً دسترسی به موقعیت مکانی را فعال کنید.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'اطلاعات موقعیت مکانی در دسترس نیست.';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'درخواست موقعیت مکانی زمان برد.';
                    break;
                case error.UNKNOWN_ERROR:
                    errorMessage = 'یک خطای ناشناخته رخ داد.';
                    break;
            }
        } else {
            errorMessage = 'مرورگر شما از قابلیت مکان‌یابی پشتیبانی نمی‌کند.';
        }
        alert(errorMessage);
    }

    document.getElementById('country').addEventListener('change', function() {
        var selectedCountry = this.options[this.selectedIndex].text;
        document.getElementById('locationDisplay').value = selectedCountry;
        document.getElementById('iranProvinces').style.display = selectedCountry === 'ایران' ? 'block' : 'none';
        resetDropdowns(['tehranCounties', 'countySections', 'districts', 'villages', 'areas', 'streets', 'alleys']);
    });

    document.getElementById('iranProvinces').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedProvince = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ')[0];
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedProvince;
            document.getElementById('iranProvinces').style.display = 'none';

            if (selectedProvince === 'تهران') {
                document.getElementById('tehranCounties').style.display = 'block';
            }
        }
    });

    document.getElementById('tehranCounties').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedCounty = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 2).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedCounty;
            document.getElementById('tehranCounties').style.display = 'none';
            document.getElementById('countySections').style.display = 'block';
        }
    });

    document.getElementById('countySections').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedSection = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 3).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedSection;
            document.getElementById('countySections').style.display = 'none';
            document.getElementById('districts').style.display = 'block';
        }
    });

    document.getElementById('districts').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedDistrict = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 4).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedDistrict;
            document.getElementById('districts').style.display = 'none';
            document.getElementById('villages').style.display = 'block';
        }
    });

    document.getElementById('villages').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedVillage = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 5).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedVillage;
            document.getElementById('villages').style.display = 'none';
            document.getElementById('areas').style.display = 'block';
        }
    });

    document.getElementById('areas').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedArea = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 6).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedArea;
            document.getElementById('areas').style.display = 'none';
            document.getElementById('streets').style.display = 'block';
        }
    });

    document.getElementById('streets').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedStreet = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 7).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedStreet;
            document.getElementById('streets').style.display = 'none';
            document.getElementById('alleys').style.display = 'block';
        }
    });

    document.getElementById('alleys').addEventListener('click', function(event) {
        event.preventDefault();
        event.stopPropagation();
        if (event.target.tagName === 'A') {
            var selectedAlley = event.target.textContent;
            var locationDisplay = document.getElementById('locationDisplay').value.split(' / ').slice(0, 8).join(' / ');
            document.getElementById('locationDisplay').value = locationDisplay + ' / ' + selectedAlley;
            document.getElementById('alleys').style.display = 'none';
        }
    });

    document.getElementById('locationDisplay').addEventListener('click', function() {
        var locationParts = this.value.split(' / ');
        if (locationParts.length === 2) {
            this.value = locationParts[0];
            document.getElementById('iranProvinces').style.display = 'block';
            resetDropdowns(['tehranCounties', 'countySections', 'districts', 'villages', 'areas', 'streets', 'alleys']);
        } else if (locationParts.length === 3) {
            this.value = locationParts.slice(0, 2).join(' / ');
            document.getElementById('tehranCounties').style.display = 'block';
            resetDropdowns(['countySections', 'districts', 'villages', 'areas', 'streets', 'alleys']);
        } else if (locationParts.length === 4) {
            this.value = locationParts.slice(0, 3).join(' / ');
            document.getElementById('countySections').style.display = 'block';
            resetDropdowns(['districts', 'villages', 'areas', 'streets', 'alleys']);
        } else if (locationParts.length === 5) {
            this.value = locationParts.slice(0, 4).join(' / ');
            document.getElementById('districts').style.display = 'block';
            resetDropdowns(['villages', 'areas', 'streets', 'alleys']);
        } else if (locationParts.length === 6) {
            this.value = locationParts.slice(0, 5).join(' / ');
            document.getElementById('villages').style.display = 'block';
            resetDropdowns(['areas', 'streets', 'alleys']);
        } else if (locationParts.length === 7) {
            this.value = locationParts.slice(0, 6).join(' / ');
        } else if (locationParts.length === 8) {
            this.value = locationParts.slice(0, 7).join(' / ');
            document.getElementById('streets').style.display = 'block';
            resetDropdowns(['alleys']);
        } else if (locationParts.length === 9) {
            this.value = locationParts.slice(0, 8).join(' / ');
            document.getElementById('alleys').style.display = 'block';
        } else if (locationParts.length === 10) {
            this.value = locationParts.slice(0, 9).join(' / ');
            document.getElementById('alleys').style.display = 'block'; // اجازه بازگشت به منوی قبلی
        } else {
            resetDropdowns(['iranProvinces', 'tehranCounties', 'countySections', 'districts', 'villages', 'areas', 'streets', 'alleys']);
        }
    });

    function resetDropdowns(dropdownIds) {
        dropdownIds.forEach(function(id) {
            document.getElementById(id).style.display = 'none';
        });
    }

    // اعتبارسنجی فرم
    document.getElementById('locationForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const locationParts = document.getElementById('locationDisplay').value.split(' / ');
        if (locationParts.length < 9 || locationParts.some(part => part.trim() === '')) {
            alert('لطفاً تمام اطلاعات لازم برای لوکیشن خود را وارد کنید.');
        } else {
            alert('ثبت لوکیشن با موفقیت انجام شد!');
            window.location.href = "specialties.html"; // هدایت به فرم تخصص‌ها پس از ثبت موفقیت آمیز
        }
    });
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="../scripts/grouping.js"></script>
</body>
</html>
 